<!-- ===================================
     TEMPLATE DE CATEGORÃAS
     Archivo: src/app/components/categorias/categorias.component.html
     =================================== -->

<div class="categorias-container">
  <!-- Header -->
  <div class="content-header">
    <h1>CategorÃ­as</h1>
    <div class="user-avatar" (click)="abrirModalAvatar()" title="Cambiar foto de perfil">
      @if (usuarioActual?.photoURL) {
      <img [src]="usuarioActual!.photoURL" alt="Foto de perfil" class="avatar-image" />
      } @else {
      {{ iniciales }}
      }
    </div>
  </div>

  <!-- Grid de categorÃ­as -->
  <div class="categories-grid">
    <div *ngIf="categorias().length === 0" class="no-categories">
      <p>No hay categorÃ­as aÃºn</p>
    </div>

    <div *ngFor="let categoria of categorias()" class="category-card">
      <div class="category-header">
        <div class="category-color" [style.background]="categoria.color"></div>
        <div class="category-info">
          <h3 [style.color]="categoria.color">{{ categoria.nombre }}</h3>
          <p>{{ obtenerCantidadProductos(categoria.nombre) }} producto(s)</p>
        </div>
      </div>

      <div *ngIf="esAdmin()" class="category-actions">
        <button class="btn-icon" (click)="abrirModalEditar(categoria)" title="Editar">
          âœï¸
        </button>
        <button class="btn-icon delete" (click)="eliminarCategoria(categoria.id, categoria.nombre)" title="Eliminar">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  </div>

  <!-- BotÃ³n flotante -->
  <button *ngIf="esAdmin()" class="add-btn" (click)="abrirModalNuevo()" title="Nueva CategorÃ­a">
    +
  </button>
</div>

<!-- MODAL -->
<div *ngIf="mostrarModal()" class="modal-overlay" (click)="cerrarModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editandoCategoria() ? 'Editar CategorÃ­a' : 'Nueva CategorÃ­a' }}</h2>
      <button class="close-btn" (click)="cerrarModal()">Ã—</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label>Nombre</label>
        <input type="text" class="form-input" [ngModel]="formCategoria().nombre"
          (ngModelChange)="actualizarForm('nombre', $event)" placeholder="Ej: Gaming" />
      </div>

      <div class="form-group">
        <label>Color</label>
        <div class="color-picker-container">
          <input type="color" class="color-input" [ngModel]="formCategoria().color"
            (ngModelChange)="actualizarForm('color', $event)" />
          <span class="color-code">{{ formCategoria().color }}</span>
        </div>
      </div>

      <div class="color-preview">
        <div class="preview-box" [style.background]="formCategoria().color"></div>
        <span>Vista previa</span>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
      <button class="btn-save" (click)="guardarCategoria()">Guardar</button>
    </div>
  </div>
</div>
<!-- MODAL DE CONFIRMACIÃ“N ELIMINAR -->
<div *ngIf="mostrarModalEliminar()" class="modal-overlay" (click)="cancelarEliminacion()">
  <div class="modal-confirm" (click)="$event.stopPropagation()">
    <div class="modal-confirm-icon">
      <span class="icon-warning">âš ï¸</span>
    </div>

    <div class="modal-confirm-content">
      <h2>Â¿Eliminar CategorÃ­a?</h2>
      <p>
        Â¿EstÃ¡s seguro que deseas eliminar
        <strong>"{{ categoriaAEliminar()?.nombre }}"</strong>?
      </p>
      <p class="warning-text">Esta acciÃ³n no se puede deshacer.</p>
    </div>

    <div class="modal-confirm-actions">
      <button class="btn-cancel-confirm" (click)="cancelarEliminacion()" [disabled]="guardando()">
        Cancelar
      </button>
      <button class="btn-delete-confirm" (click)="confirmarEliminacion()" [disabled]="guardando()">
        @if (guardando()) {
        <span class="spinner"></span> Eliminando...
        } @else {
        ğŸ—‘ï¸ Eliminar
        }
      </button>
    </div>
  </div>
</div>

<!-- Modal de Avatar -->
<app-avatar-modal [visible]="mostrarModalAvatar()" [currentPhotoURL]="usuarioActual?.photoURL" [iniciales]="iniciales"
  (cerrar)="cerrarModalAvatar()" (fotoActualizada)="onFotoActualizada($event)"></app-avatar-modal>