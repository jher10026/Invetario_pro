<div class="app-container">
  <app-sidebar></app-sidebar>

  <main class="main-content">
    <div class="content-header">
      <h1>üìã Inventario</h1>
      <div class="user-avatar">{{ obtenerIniciales() }}</div>
    </div>

    <div class="table-container">
      <!-- Header -->
      <div class="table-header">
        <h2>Lista de Productos</h2>
        <button 
          class="btn btn-primary" 
          (click)="abrirModalAgregar()"
          *ngIf="esAdmin()"
        >
          ‚ûï Nuevo
        </button>
      </div>

      <!-- Filtros -->
      <div class="filters">
        <input
          type="text"
          class="search-input"
          placeholder="üîç Buscar producto..."
          [(ngModel)]="busqueda"
          (ngModelChange)="aplicarFiltros()"
        />

        <select
          class="select-input"
          [(ngModel)]="categoriaFiltro"
          (ngModelChange)="aplicarFiltros()"
        >
          <option value="">Todas las Categor√≠as</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>

        <select
          class="select-input"
          [(ngModel)]="estadoFiltro"
          (ngModelChange)="aplicarFiltros()"
        >
          <option value="">Todos los Estados</option>
          <option value="disponible">En Stock</option>
          <option value="bajo">Stock Bajo</option>
          <option value="agotado">Agotado</option>
        </select>

        <select
          class="select-input"
          [(ngModel)]="ordenamiento"
          (ngModelChange)="aplicarFiltros()"
        >
          <option value="recent">M√°s Recientes</option>
          <option value="oldest">M√°s Antiguos</option>
          <option value="name">Por Nombre</option>
          <option value="price">Por Precio</option>
        </select>
      </div>

      <!-- Tabla -->
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Producto / Fecha</th>
              <th>Categor√≠a</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Acci√≥n</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="productosFiltrados.length === 0">
              <td colspan="5" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                No hay productos registrados
              </td>
            </tr>
            <tr *ngFor="let producto of productosFiltrados">
              <!-- Producto / Fecha -->
              <td>
                <div style="font-weight: 600;">{{ producto.nombre }}</div>
                <div style="font-size: 0.75rem; color: var(--text-secondary);">
                  üìÖ {{ formatearFecha(producto.fechaCreacion) }}
                </div>
              </td>

              <!-- Categor√≠a -->
              <td>
                <span class="badge" style="background: rgba(99, 102, 241, 0.15); color: #818cf8;">
                  {{ producto.categoria }}
                </span>
              </td>

              <!-- Precio -->
              <td style="font-weight: 600;">{{ formatearPrecio(producto.precio) }}</td>

              <!-- Stock -->
              <td>
                <span [class]="getClaseEstado(producto)">
                  {{ producto.stock }}
                </span>
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                  {{ getEstadoStock(producto) }}
                </div>
              </td>

              <!-- Acciones -->
              <td>
                <div style="display: flex; gap: 0.5rem;">
                  <button
                    class="action-btn edit"
                    (click)="abrirModalEditar(producto)"
                    [disabled]="!esAdmin()"
                    title="Editar"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    class="action-btn delete"
                    (click)="eliminarProducto(producto)"
                    [disabled]="!esAdmin()"
                    title="Eliminar"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Footer -->
      <div class="table-footer">
        Mostrando {{ productosFiltrados.length }} productos
      </div>
    </div>

    <!-- Mensaje para usuarios sin permisos -->
    <div *ngIf="!esAdmin()" style="margin-top: 1rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: var(--radius-md); border-left: 3px solid var(--accent-primary);">
      <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
        <strong style="color: var(--text-primary);">‚ÑπÔ∏è Modo solo lectura:</strong> No tienes permisos para modificar el inventario. Solo el administrador puede agregar, editar o eliminar productos.
      </p>
    </div>
  </main>
</div>

<!-- Modal de Producto -->
<div class="modal" [class.active]="mostrarModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>{{ modoEdicion ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto' }}</h2>
    </div>

    <form (ngSubmit)="guardarProducto()">
      <!-- Nombre -->
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input
          type="text"
          class="form-input"
          [(ngModel)]="formulario.nombre"
          name="nombre"
          placeholder="Ej: Laptop HP"
          required
        />
      </div>

      <!-- Fecha de Ingreso -->
      <div class="form-group">
        <label class="form-label">Fecha de Ingreso</label>
        <input
          type="date"
          class="form-input"
          [(ngModel)]="formulario.fecha"
          name="fecha"
          required
        />
      </div>

      <!-- Categor√≠a -->
      <div class="form-group">
        <label class="form-label">Categor√≠a</label>
        <select
          class="form-input"
          [(ngModel)]="formulario.categoria"
          name="categoria"
          required
        >
          <option value="">Seleccionar categor√≠a</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- Precio y Stock -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Precio</label>
          <input
            type="number"
            class="form-input"
            [(ngModel)]="formulario.precio"
            name="precio"
            min="0"
            step="0.01"
            placeholder="0.00"
            required
          />
        </div>

        <div class="form-group">
          <label class="form-label">Stock</label>
          <input
            type="number"
            class="form-input"
            [(ngModel)]="formulario.stock"
            name="stock"
            min="0"
            placeholder="0"
            required
          />
        </div>
      </div>

      <!-- Stock M√≠nimo -->
      <div class="form-group">
        <label class="form-label">Stock M√≠nimo (Alerta)</label>
        <input
          type="number"
          class="form-input"
          [(ngModel)]="formulario.stockMinimo"
          name="stockMinimo"
          min="1"
          placeholder="5"
          required
        />
      </div>

      <!-- Botones -->
      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="cerrarModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-save">
          {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>

<app-toast></app-toast>